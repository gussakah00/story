const CACHE_NAME="cerita-sekitarmu-v2.2.0",APP_SHELL_CACHE="app-shell-v2",BASE_PATH="/story",ESSENTIAL_FILES=["./","./index.html","./main.bundle.js","./styles.css","./manifest.json"],OPTIONAL_FILES=["./favicon.png","./icons/icon-72x72.png","./icons/icon-96x96.png","./icons/icon-128x128.png","./icons/icon-144x144.png","./icons/icon-152x152.png","./icons/icon-192x192.png","./icons/icon-384x384.png","./icons/icon-512x512.png"];function createOfflineResponse(){return new Response('\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>Anda Sedang Offline - Cerita di Sekitarmu</title>\n        \n      </head>\n      <body>\n        <div class="container">\n          <h1>ðŸ“¶ Anda Sedang Offline</h1>\n          <p>Aplikasi membutuhkan koneksi internet untuk mengambil data cerita terbaru.</p>\n          <p>Silakan periksa koneksi internet Anda dan coba lagi.</p>\n        </div>\n      </body>\n    </html>\n  ',{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"text/html; charset=utf-8","Cache-Control":"no-cache"}})}self.addEventListener("install",(e=>{console.log("ðŸ”§ Service Worker: Memulai instalasi..."),e.waitUntil(self.skipWaiting()),e.waitUntil((async()=>{try{const e=await caches.open("app-shell-v2");console.log("ðŸ’¾ Membuka cache..."),console.log("ðŸ“¦ Caching file essential...");const n=(await Promise.allSettled(ESSENTIAL_FILES.map((n=>e.add(n).catch((e=>(console.warn(`âš ï¸ Gagal cache essential ${n}:`,e.message),null))))))).filter((e=>"fulfilled"===e.status&&null!==e.value)).length;console.log(`âœ… ${n}/${ESSENTIAL_FILES.length} file essential berhasil di-cache`),console.log("ðŸ“¦ Caching file optional...");const a=(await Promise.allSettled(OPTIONAL_FILES.map((async n=>{try{return await e.add(n),console.log(`âœ… Berhasil cache optional: ${n}`),{success:!0,url:n}}catch(e){return console.warn(`âš ï¸ Gagal cache optional ${n}:`,e.message),{success:!1,url:n,error:e.message}}})))).filter((e=>"fulfilled"===e.status&&e.value.success)).length;console.log(`ðŸ“Š Cache result: ${n}/${ESSENTIAL_FILES.length} essential, ${a}/${OPTIONAL_FILES.length} optional berhasil`),console.log("ðŸŽ‰ Proses caching selesai")}catch(e){console.error("âŒ Error utama saat caching:",e)}})())})),self.addEventListener("activate",(e=>{console.log("ðŸ”„ Service Worker: Mengaktifkan..."),e.waitUntil((async()=>{await self.clients.claim();try{const e=await caches.keys();await Promise.all(e.map((async e=>{"app-shell-v2"!==e&&e!==CACHE_NAME&&(console.log(`ðŸ—‘ï¸ Menghapus cache lama: ${e}`),await caches.delete(e))})))}catch(e){console.warn("âš ï¸ Error cleaning old caches:",e)}console.log("âœ… Service Worker aktif dan siap!")})())})),self.addEventListener("fetch",(e=>{const{request:n}=e;if("GET"!==n.method)return;const a=new URL(n.url);a.href.includes("story-api.dicoding.dev")||a.href.startsWith(self.location.origin)&&e.respondWith((async()=>{try{const e=await caches.match(n);if(e)return e;const t=await fetch(n);if(t&&200===t.status&&!a.href.includes("story-api.dicoding.dev"))try{const e=await caches.open("app-shell-v2");await e.put(n,t.clone())}catch(e){console.warn(`âš ï¸ Gagal menyimpan ke cache: ${a.pathname}`)}return t}catch(e){if(console.log(`âŒ Network error: ${a.pathname}`),"document"===n.destination||n.headers.get("accept")?.includes("text/html")){const e=await caches.match("./index.html");if(e)return e}return createOfflineResponse()}})())})),self.addEventListener("push",(e=>{console.log("ðŸ“¨ Menerima push notification"),e.waitUntil(self.registration.showNotification("Cerita di Sekitarmu",{body:"Ada cerita baru di sekitarmu! ðŸ“–",icon:"./icons/icon-192x192.png",badge:"./icons/icon-72x72.png",tag:"cerita-notification"}))})),self.addEventListener("notificationclick",(e=>{console.log("ðŸ‘† Notification diklik"),e.notification.close(),e.waitUntil(self.clients.matchAll({type:"window"}).then((e=>{for(const n of e)if(n.url.includes(self.location.origin))return n.focus();return self.clients.openWindow("./")})))})),console.log("ðŸš€ Service Worker loaded dan siap! Versi 2.2.0");