const CACHE_NAME="cerita-sekitarmu-v1.0.0",APP_SHELL_CACHE="app-shell-v1",ESSENTIAL_FILES=["./","./index.html","./manifest.json","./styles.css"],OPTIONAL_FILES=["./favicon.png","./icons/icon-72x72.png","./icons/icon-96x96.png","./icons/icon-128x128.png","./icons/icon-144x144.png","./icons/icon-152x152.png","./icons/icon-192x192.png","./icons/icon-384x384.png","./icons/icon-512x512.png"];self.addEventListener("install",(e=>{console.log("ðŸ”§ Service Worker: Install"),self.skipWaiting(),e.waitUntil((async()=>{try{const e=await caches.open("app-shell-v1");console.log("ðŸ“¦ Caching essential files...");for(const n of ESSENTIAL_FILES)try{const t=await fetch(n);t.ok&&(await e.put(n,t),console.log(`âœ… ${n}`))}catch(e){console.warn(`âŒ Gagal cache: ${n}`)}console.log("ðŸ“¦ Caching optional files...");for(const n of OPTIONAL_FILES)try{const t=await fetch(n);t.ok&&await e.put(n,t)}catch(e){}console.log("ðŸŽ‰ Caching selesai")}catch(e){console.error("Error caching:",e)}})())})),self.addEventListener("activate",(e=>{console.log("ðŸ”„ Service Worker: Activate"),e.waitUntil((async()=>{await self.clients.claim();const e=await caches.keys();await Promise.all(e.map((async e=>{"app-shell-v1"!==e&&e!==CACHE_NAME&&await caches.delete(e)}))),console.log("âœ… Service Worker aktif")})())})),self.addEventListener("fetch",(e=>{const{request:n}=e;if("GET"!==n.method)return;const t=new URL(n.url);t.href.includes("story-api.dicoding.dev")||t.href.startsWith(self.location.origin)&&e.respondWith((async()=>{const e=await caches.match(n);if(e)return e;try{const e=await fetch(n);return 200===e.status&&(await caches.open("app-shell-v1")).put(n,e.clone()),e}catch(e){if("document"===n.destination){const e=await caches.match("./index.html");if(e)return e}return new Response("<h1>Anda sedang offline</h1><p>Cek koneksi internet Anda.</p>",{status:503,headers:{"Content-Type":"text/html"}})}})())})),self.addEventListener("push",(e=>{e.waitUntil(self.registration.showNotification("Cerita di Sekitarmu",{body:"Ada cerita baru di sekitarmu! ðŸ“–",icon:"./icons/icon-192x192.png",badge:"./icons/icon-72x72.png"}))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(self.clients.matchAll({type:"window"}).then((e=>{for(const n of e)if(n.url.includes(self.location.origin))return n.focus();return self.clients.openWindow("./")})))})),console.log("ðŸš€ Service Worker loaded");