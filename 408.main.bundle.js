"use strict";(self.webpackChunkcerita_di_sekitarmu=self.webpackChunkcerita_di_sekitarmu||[]).push([[408],{188:(e,a,t)=>{t.d(a,{DY:()=>l,Lx:()=>i,ZO:()=>o,y_:()=>s});var r=t(763);const n="https://story-api.dicoding.dev/v1";async function o(){const e=r.y.getToken();if(!e)return console.log("User belum login, tidak bisa mengambil data stories"),[];try{console.log("ðŸ” DEBUG - Fetching stories from API...");const a=new AbortController,t=setTimeout((()=>a.abort()),1e4),r=await fetch(`${n}/stories`,{headers:{Authorization:`Bearer ${e}`},signal:a.signal});if(clearTimeout(t),!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.json();return console.log("ðŸ” DEBUG - Full API Response:",o),o.error||!o.listStory?(console.error("API returned error:",o.message),[]):o.listStory.map((e=>{let a=e.photoUrl;return e.photoUrl&&e.photoUrl.startsWith("http")||(a="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkdhbWJhciB0aWRhayB0ZXJzZWRpYTwvdGV4dD48L3N2Zz4="),{id:e.id,name:e.name,description:e.description,photoUrl:a,lat:e.lat,lon:e.lon,createdAt:e.createdAt}}))}catch(e){return console.error("âŒ Error fetching stories:",e),"AbortError"===e.name?console.error("Request timeout - API server mungkin lambat"):"TypeError"===e.name&&e.message.includes("Failed to fetch")&&console.error("Network error - Tidak bisa connect ke API server"),[]}}async function s({description:e,photo:a,lat:t,lon:o}){const s=r.y.getToken();if(!s)return{error:!0,message:"Anda harus login untuk menambah cerita."};const i=new FormData;i.append("description",e),i.append("photo",a),t&&i.append("lat",t),o&&i.append("lon",o);try{console.log("ðŸ” DEBUG - Mulai mengirim cerita ke API...");const e=new AbortController,a=setTimeout((()=>e.abort()),3e4),t=await fetch(`${n}/stories`,{method:"POST",body:i,headers:{Authorization:`Bearer ${s}`},signal:e.signal});clearTimeout(a),console.log("ðŸ” DEBUG - Response status:",t.status);const r=await t.json();return console.log("ðŸ” DEBUG - Response data:",r),!t.ok||r.error?{error:!0,message:r.message||`Error ${t.status}: ${t.statusText}`}:(console.log("ðŸ” DEBUG - Cerita berhasil dikirim:",r),r)}catch(e){return console.error("ðŸ” DEBUG - Error detail:",e),"AbortError"===e.name?{error:!0,message:"Request timeout - Server terlalu lama merespon."}:"TypeError"===e.name&&e.message.includes("Failed to fetch")?{error:!0,message:"Gagal terhubung ke server. Periksa koneksi internet Anda."}:{error:!0,message:`Gagal mengirim data: ${e.message}`}}}async function i({email:e,password:a}){try{const t=new AbortController,r=setTimeout((()=>t.abort()),1e4),o=await fetch(`${n}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:a}),signal:t.signal});clearTimeout(r);const s=await o.json();return o.ok?{error:!1,data:s}:{error:!0,message:s.message||"Login gagal"}}catch(e){return"AbortError"===e.name?{error:!0,message:"Request timeout - Server terlalu lama merespon."}:{error:!0,message:"Terjadi kesalahan jaringan"}}}async function l({name:e,email:a,password:t}){try{const r=new AbortController,o=setTimeout((()=>r.abort()),1e4),s=await fetch(`${n}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:a,password:t}),signal:r.signal});clearTimeout(o);const i=await s.json();return s.ok?{error:!1,data:i}:{error:!0,message:i.message||"Pendaftaran gagal"}}catch(e){return"AbortError"===e.name?{error:!0,message:"Request timeout - Server terlalu lama merespon."}:{error:!0,message:"Terjadi kesalahan jaringan"}}}},408:(e,a,t)=>{t.r(a),t.d(a,{default:()=>o});var r=t(188),n=t(763);const o={render:async()=>'\n      <section class="auth-page" aria-labelledby="login-title">\n        <h1 id="login-title" tabindex="0">Masuk ke Akun Anda</h1>\n        <form id="loginForm" class="auth-form" aria-labelledby="login-title" autocomplete="off">\n          <div class="form-group">\n            <label for="login-email">Email:</label>\n            <input \n              type="email" \n              id="login-email" \n              name="email" \n              required \n              aria-required="true"\n              placeholder="Masukkan email Anda"\n              autocomplete="new-email"\n              aria-describedby="email-help"\n            >\n            <p id="email-help" class="form-help">Masukkan alamat email yang terdaftar</p>\n            <p id="email-error" class="error-message" aria-live="polite"></p>\n          </div>\n          \n          <div class="form-group">\n            <label for="login-password">Kata Sandi:</label>\n            <input \n              type="password" \n              id="login-password" \n              name="password" \n              required \n              aria-required="true"\n              placeholder="Masukkan kata sandi Anda"\n              autocomplete="new-password"\n              aria-describedby="password-help"\n            >\n            <p id="password-help" class="form-help">Masukkan kata sandi akun Anda</p>\n            <p id="password-error" class="error-message" aria-live="polite"></p>\n          </div>\n          \n          <button type="submit" class="submit-button">Masuk</button>\n          <p class="auth-link">\n            Belum punya akun? <a href="#/register" class="link">Daftar di sini</a>\n          </p>\n        </form>\n        <div id="auth-message" class="info-message" aria-live="polite" style="display:none;"></div>\n      </section>\n    ',async afterRender(){this._setupFormValidation(),this._setupFormSubmission()},_setupFormValidation(){document.getElementById("loginForm");const e=document.getElementById("login-email"),a=document.getElementById("login-password");e.addEventListener("blur",(()=>{const a=e.value.trim(),t=document.getElementById("email-error");a?(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))(a)?(t.textContent="",e.setAttribute("aria-invalid","false")):(t.textContent="Format email tidak valid",e.setAttribute("aria-invalid","true")):(t.textContent="Email harus diisi",e.setAttribute("aria-invalid","true"))})),a.addEventListener("blur",(()=>{const e=a.value,t=document.getElementById("password-error");e?e.length<6?(t.textContent="Kata sandi minimal 6 karakter",a.setAttribute("aria-invalid","true")):(t.textContent="",a.setAttribute("aria-invalid","false")):(t.textContent="Kata sandi harus diisi",a.setAttribute("aria-invalid","true"))})),setTimeout((()=>{e.value="",a.value=""}),100)},_setupFormSubmission(){const e=document.getElementById("loginForm"),a=document.getElementById("auth-message");e.addEventListener("submit",(async t=>{t.preventDefault();const o=document.getElementById("login-email").value.trim(),s=document.getElementById("login-password").value;if(!o||!s)return a.textContent="Harap isi semua field yang diperlukan",a.style.display="block",void(a.style.backgroundColor="#fee");const i=e.querySelector(".submit-button");i.disabled=!0,i.textContent="Memproses...",a.textContent="Sedang masuk...",a.style.display="block",a.style.backgroundColor="#e3f2fd";try{const e=await(0,r.Lx)({email:o,password:s});if(e.error)throw new Error(e.message);n.y.login(e.data.loginResult.token,{name:e.data.loginResult.name,email:o}),a.textContent="Login berhasil! Mengarahkan ke beranda...",a.style.backgroundColor="#e8f5e8",window.dispatchEvent(new Event("authchange")),setTimeout((()=>{window.location.hash="#/beranda"}),2e3)}catch(e){a.textContent=`Login gagal: ${e.message}`,a.style.backgroundColor="#fee",i.disabled=!1,i.textContent="Masuk"}}))}}}}]);